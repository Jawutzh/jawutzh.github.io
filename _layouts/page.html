---
layout: default
---

<div class="page-card">
    <div class="page-meta"><span class="page-title">{{ page.title }}</span></div>
    <div class="page-content" id="pageContent">
        {% if page.encrypted %}
			<div class="post-encrypted">
			<i class="fa fa-lock"></i>
			此文已加密，請输入密钥以解密。
			</div>
			<script src ="{{ site.url }}/js/aes.js"></script>
			<div>
				<input type="password" id="psdta" placeholder="请输入文章密钥以解密" autocomplete="off"></input>
				<button id="handinpw" onclick="decryptPost()">确认</button>
				<div id="output"></div>
			</div>

			<script>
			var encrypt = "{{ content | strip_html | strip_newlines }}"
			</script>
			<script>
			function decryptPost(){
				var key = psdta.value
				if(!key){
					output.innerHTML = '请输入密钥。'
				}
				else{
					var decrypt = CryptoJS.AES.decrypt(encrypt, CryptoJS.enc.Utf8.parse(key), {
									mode: CryptoJS.mode.ECB,
									padding: CryptoJS.pad.Pkcs7
								});
					try{
						pageContent.innerHTML = decrypt.toString(CryptoJS.enc.Utf8);
					}
					catch{
						output.innerHTML = '解密失败，密钥或密文错误。'
						
					}
				}
			}

			psdta.addEventListener("keyup", function(event) {
			    if (event.keyCode === 13) {
				handinpw.click();
			    }
			})
			</script>
		{% else %}	
			{{ content }}
		{% endif %}
    </div>
</div>

{% if page.gitalk %}
	{% include comments.html %}
{% endif %}